Index: resources/views/polls/create.blade.php
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>@extends('layouts.app')\r\n\r\n@section('content')\r\n<h1>Create Poll</h1>\r\n<div class=\"container new-poll\">\r\n    <div class=\"row justify-content-center\">\r\n        <div class=\"col-md-10\">\r\n            <div class=\"card\">\r\n                {{--@if ($errors->any())\r\n                    <div class=\"alert alert-danger\">\r\n                        <ul>\r\n                            @foreach ($errors->all() as $error)\r\n                                <li>{{ $error }}</li>\r\n                            @endforeach\r\n                        </ul>\r\n                    </div>\r\n                @endif--}}\r\n                <div class=\"card-body\">\r\n                    <div class=\"border-container\">\r\n                        <form action=\"{{ route('polls.newpoll') }} \" method=\"post\">\r\n                            @csrf\r\n                            {{ method_field('PUT') }}\r\n                           {{-- <input type=\"hidden\" name=\"pollid\" value=\"{{ $id }}\">--}}\r\n                            <h3>Add poll question:</h3>\r\n                            <div class=\"form-group\">\r\n                                <label>\r\n                                    <span>Question:</span>\r\n                                    <input  type=\"text\" class=\"form-control\" name=\"question\"  placeholder=\"poll question\">\r\n                                    @if ($errors->any())\r\n                                        <label for=\"question\" class=\"error\">{{ $errors->first('question') }}</label>\r\n                                    @endif\r\n                                </label>\r\n                            </div>\r\n                            <h3>Add poll answers:</h3>\r\n                            <div class=\"form-group\">\r\n                                <label>\r\n                                    <span>Answer 1:</span>\r\n                                    <input class=\"form-control\"  type=\"text\" name=\"answer1\"  placeholder=\"answer 1\">\r\n                                    @if ($errors->any())\r\n                                        <label for=\"answer1\" class=\"error\">{{ $errors->first('answer1') }}</label>\r\n                                    @endif\r\n                                </label>\r\n                            </div>\r\n                            <div class=\"form-group\">\r\n                                <label>\r\n                                    <span>Answer 2:</span>\r\n                                    <input  type=\"text\" class=\"form-control\" name=\"answer2\"  placeholder=\"answer 2\">\r\n                                    @if ($errors->any())\r\n                                        <label for=\"answer2\" class=\"error\">{{ $errors->first('answer2') }}</label>\r\n                                    @endif\r\n                                </label>\r\n                            </div>\r\n                            <div class=\"form-group\">\r\n                                <label>\r\n                                    <span>Answer 3:</span>\r\n                                    <input  type=\"text\" class=\"form-control\" name=\"answer3\"  placeholder=\"answer 3\">\r\n                                </label>\r\n                            </div>\r\n                            <div class=\"form-group\">\r\n                                <label>\r\n                                    <span>Answer 4:</span>\r\n                                    <input  type=\"text\" class=\"form-control\" name=\"answer4\"  placeholder=\"answer 4\">\r\n                                </label>\r\n                            </div>\r\n                            <div class=\"form-control btn-wrap\">\r\n                                <button type=\"submit\" class=\"btn btn-primary form-control\">Create New Poll</button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n@endsection\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- resources/views/polls/create.blade.php	(revision 96505ac51af98caee5316e62bb98006eac3ecdd0)
+++ resources/views/polls/create.blade.php	(date 1587549997895)
@@ -25,7 +25,7 @@
                             <div class="form-group">
                                 <label>
                                     <span>Question:</span>
-                                    <input  type="text" class="form-control" name="question"  placeholder="poll question">
+                                    <input  type="text" class="form-control" name="question" value="{{ old('question') }}"  placeholder="poll question">
                                     @if ($errors->any())
                                         <label for="question" class="error">{{ $errors->first('question') }}</label>
                                     @endif
Index: resources/views/polls/index.blade.php
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>@extends('layouts.app')\r\n\r\n@section('content')\r\n<h1>Polls</h1>\r\n<div class=\"container polls-page\">\r\n    <div class=\"row justify-content-center\">\r\n        <div class=\"col-md-8\">\r\n            <div class=\"card\">\r\n                <div class=\"card-body\">\r\n                    <div class=\"border-container\">\r\n                        <form action=\"{{ route('polls.store') }} \" method=\"post\">\r\n                            @csrf\r\n                            <input id=\"name\" type=\"hidden\" value=\" {{{ isset(Auth::user()->name) ? Auth::user()->name : Auth::user()->email }}}\" name=\"user\">\r\n                            <div class=\"form-check\">\r\n                                <h2>{{ $polls->name }}</h2>\r\n                                <input type=\"hidden\" name=\"title\" value=\"{{ $polls->name }}\">\r\n                                <input type=\"hidden\" name=\"pollid\" value=\"{{ $polls->id }}\">\r\n                            </div>\r\n                            <div class=\"form-check\">\r\n                                <ul>\r\n                                    @foreach($answers as $answer)\r\n                                    <li class=\"answer\">\r\n                                        <label class=\"form-check-label\">\r\n                                            <input type=\"radio\" class=\"form-check-input\" name=\"answer\" value=\"{{ $answer->id }}\"><strong>{{ $answer->name }}</strong>\r\n                                            <span class=\"checkmark\"></span>\r\n                                            <input type=\"hidden\" class=\"form-check-input\" name=\"answerid\" value=\"{{ $answer->id }}\">\r\n                                        </label>\r\n                                    </li>\r\n                                    @endforeach\r\n                                </ul>\r\n                            </div>\r\n                            <div class=\"btn-holder\">\r\n                                <button type=\"submit\" class=\"btn btn-primary\">Submit</button>\r\n                            </div>\r\n                        </form>\r\n                        <div class=\"comments-section\">\r\n                            <ul>\r\n                                <li>\r\n                                    <h6>Comments:</h6>\r\n                                </li>\r\n                                <li>\r\n                                    @foreach ($pollComments->pollComments as $item)\r\n                                        <div class=\"comment\">\r\n                                            <span>{{ $item->username }}</span>\r\n                                            <p>{{ $item->comments }}</p>\r\n                                        </div>\r\n                                    @endforeach\r\n                                </li>\r\n                            </ul>\r\n                            <form action=\"{{ route('poll/comments') }}\" method=\"post\">\r\n                                @csrf\r\n                                <input type=\"hidden\" name=\"pollid\" value=\"{{ $polls->id }}\">\r\n                                <div class=\"form-group\">\r\n                                    <textarea class=\"form-control\" name=\"comments\" id=\"comments\" rows=\"3\" placeholder=\"Add a comment:\"></textarea>\r\n                                    @if ($errors->any())\r\n                                        <label for=\"comments\" class=\"error\">{{ $errors->first('comments') }}</label>\r\n                                    @endif\r\n                                </div>\r\n                                <div class=\"form-group btn-wrap\">\r\n                                    <input type=\"submit\" class=\"btn btn-success\" value=\"Add Comment\" />\r\n                                </div>\r\n                            </form>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class=\"col-md-3 side-tile\">\r\n            <div class=\"box\">\r\n                <h6>Related sign up</h6>\r\n                    <a href=\"{{ route('poll-related', $signup->id) }}\" class=\"link\">{{ $signup->title }}</a>\r\n            </div>\r\n            <div class=\"box\">\r\n                <h6>Archive</h6>\r\n                @foreach($allPolls as $poll)\r\n                    <a href=\"{{ route('poll-all', $poll->id )}}\" class=\"link\">{{ $poll->name }}</a>\r\n                @endforeach\r\n            </div>\r\n        </div>\r\n    </div>\r\n@endsection\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- resources/views/polls/index.blade.php	(revision 96505ac51af98caee5316e62bb98006eac3ecdd0)
+++ resources/views/polls/index.blade.php	(date 1587550681146)
@@ -68,7 +68,12 @@
         <div class="col-md-3 side-tile">
             <div class="box">
                 <h6>Related sign up</h6>
+                @if ($signup !== null)
                     <a href="{{ route('poll-related', $signup->id) }}" class="link">{{ $signup->title }}</a>
+                @else
+                    <p>No related signups</p>
+                @endif
+
             </div>
             <div class="box">
                 <h6>Archive</h6>
Index: app/Http/Controllers/PollController.php
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?php\r\n\r\nnamespace App\\Http\\Controllers;\r\n\r\nuse App\\Category;\r\nuse App\\Events\\NewPollEvent;\r\nuse App\\Events\\UserPollEvent;\r\nuse App\\Exports\\PollExport;\r\nuse App\\Http\\Requests\\PollCommentsStoreRequest;\r\nuse App\\Jobs\\SendEmailPollJob;\r\nuse App\\Mail\\MailForNewPoll;\r\nuse App\\PollComment;\r\nuse App\\Signup;\r\nuse App\\SignupTitle;\r\nuse App\\SubscribeUser;\r\nuse Barryvdh\\DomPDF\\Facade as PDF;\r\nuse App\\User;\r\nuse Illuminate\\Support\\Facades\\Mail;\r\nuse Maatwebsite\\Excel\\Facades\\Excel;\r\nuse App\\Http\\Requests\\PollStoreRequest;\r\nuse App\\Poll;\r\nuse App\\PollAnswer;\r\nuse App\\PollResult;\r\nuse App\\Charts\\PollChart;\r\nuse Illuminate\\Http\\Request;\r\nuse Illuminate\\Support\\Facades\\DB;\r\nuse Illuminate\\Support\\Facades\\Gate;\r\nuse Yajra\\DataTables\\DataTables;\r\n\r\nclass PollController extends Controller\r\n{\r\n    public function __construct()\r\n    {\r\n        $this->middleware('auth');\r\n    }\r\n\r\n    public function index()\r\n    {\r\n\r\n        $polls = Poll::with('answer')->get()->sortByDesc('id')->first();\r\n        $id = $polls->id;\r\n        $answers = PollAnswer::where('poll_id', $id)->get();\r\n        $authUserName = auth()->user()->name;\r\n        $pollComments = Poll::with('pollComments')->get()->sortByDesc('id')->first();\r\n        $chart = New PollChart();\r\n        $chart->labels(['Jamaica', 'Spain', 'Greece', 'Sozopol']);\r\n        $chart->dataset('My dataset', 'line', $answers );\r\n\r\n        $allPolls = Poll::all();\r\n        $signup = SignupTitle::where('id', $id)->first();\r\n\r\n        return view('polls.index', compact(['polls', 'authUserName', 'answers', 'chart', 'pollComments', 'allPolls', 'signup']));\r\n    }\r\n\r\n    public function managePools(Request $request)\r\n    {\r\n        if ($request->ajax()) {\r\n            $data = Poll::latest()->get();\r\n            return Datatables::of($data)\r\n                ->addIndexColumn()\r\n                ->addColumn('action', function($row){\r\n                    $btn ='\r\n                       <form action=\"' .route('poll/delete',$row->id) . '\" method=\"post\">\r\n                      ' .csrf_field() .'\r\n                       <input type=\"hidden\" name=\"_method\" value=\"DELETE\">\r\n                         <button class=\"btn btn-danger\">Delete</button></form>\r\n                         ';\r\n                    return $btn;\r\n                })\r\n                ->rawColumns(['action', 'delete'])\r\n                ->make(true);\r\n        }\r\n        return view('polls.manage-pools');\r\n    }\r\n\r\n    public function store(Request $request)\r\n    {\r\n        $uname = $request->input('user');\r\n        $p_id = $request->input('pollid');\r\n        $userSign = PollResult::where('poll_id', $p_id)->where('username', $uname)->first();\r\n        $answerObj = PollAnswer::where('id', $request->input('answer'))->first();\r\n       if (!$userSign) {\r\n            $result = new PollResult();\r\n\r\n            $result->answer_id = $request->input('answer');\r\n            $result->answer = $answerObj->name;\r\n            $result->question = $request->input('title');\r\n            $result->username = auth()->user()->name;\r\n            $result->poll_id = $request->pollid;\r\n            $result->save();\r\n\r\n            event(new UserPollEvent());\r\n\r\n           /*$email = auth()->user()->email;\r\n           $details['email'] = $email;\r\n           dispatch(new SendEmailPollJob($details));*/\r\n\r\n\r\n            $polls = Poll::with('answer')->get()->sortByDesc('id')->first();\r\n           $allVotes = PollResult::where('poll_id', $p_id)->get();\r\n            $pollAnswers = $polls->answer->pluck('name')->toArray();\r\n            $authUserName = auth()->user()->name;\r\n\r\n            $count = PollResult::where('poll_id', $p_id)->get()->groupBy('answer');\r\n            $chart = New PollChart();\r\n            $data = array();\r\n            $num = [];\r\n            foreach ($pollAnswers as $k => $pollAnswer) {\r\n                if (array_key_exists($pollAnswer, $count->toArray())) {\r\n                    $data[$k] =  count($count->toArray()[$pollAnswer]);\r\n                    $num[] = $pollAnswer;\r\n                } else {\r\n                    $data[$k] = 0;\r\n                    $num[] = $pollAnswer;\r\n                }\r\n            }\r\n\r\n            $chart->labels([$num[0], $num[1], $num[2], $num[3]]);\r\n            $chart->dataset('Poll Result', 'bar', [$data[0], $data[1], $data[2], $data[3]] );\r\n\r\n            return view('polls.result', compact(['userSign', 'allVotes', 'authUserName', 'count', 'chart']))->with('success', 'Thanks for voting');\r\n\r\n        } else\r\n        {\r\n            return redirect('poll/result')->with('error', 'You already have voted, please delete your vote to be able to vote again!');\r\n        }\r\n\r\n\r\n    }\r\n\r\n    public function result()\r\n    {\r\n        $polls = Poll::with('answer')->get()->sortByDesc('id')->first();\r\n        $pollAnswers = $polls->answer->pluck('name')->toArray();\r\n        $id = $polls->id;\r\n        $allVotes = PollResult::where('poll_id', $id)->get()->sortByDesc('id');\r\n        $authUserName = auth()->user()->name;\r\n        $count = PollResult::where('poll_id', $id)->get()->groupBy('answer');\r\n        $chart = New PollChart();\r\n        $data = array();\r\n        $num = [];\r\n        foreach ($pollAnswers as $k => $pollAnswer) {\r\n            if (array_key_exists($pollAnswer, $count->toArray())) {\r\n                $data[$k] =  count($count->toArray()[$pollAnswer]);\r\n                $num[] = $pollAnswer;\r\n            } else {\r\n                $data[$k] = 0;\r\n                $num[] = $pollAnswer;\r\n            }\r\n        }\r\n        $chart->labels([$num[0], $num[1], $num[2], $num[3]]);\r\n        $chart->dataset('Poll Result', 'bar', [$data[0], $data[1], $data[2], $data[3]] );\r\n        return view('polls.result', compact(['allVotes', 'authUserName', 'count', 'chart']));\r\n    }\r\n\r\n    public function destroy(Request $request, $id)\r\n    {\r\n        $vote = PollResult::find($id);\r\n        $vote->delete();\r\n        return redirect()->route('polls.index')->with('success', 'Your vote was deleted');\r\n    }\r\n\r\n    public function deletePoll($id)\r\n    {\r\n        $poll = Poll::find($id);\r\n        $poll->delete();\r\n        return redirect()->back()->with('success', 'Poll was deleted');\r\n    }\r\n\r\n    public function manage()\r\n    {\r\n        $polls = Poll::all();\r\n        return view('polls.index2', compact('polls'));\r\n    }\r\n\r\n    public function create()\r\n    {\r\n        return view('polls.create');\r\n    }\r\n\r\n    public function newpoll(Request $request, PollStoreRequest $pollStoreRequest)\r\n    {\r\n            $question = new Poll();\r\n            $question->name = $request->question;\r\n            $question->save();\r\n            $question->answer();\r\n            $pollid = $question->id;\r\n\r\n\r\n            $answer = new PollAnswer();\r\n            $answer->name = $request->answer1;\r\n            $answer->poll_id = $pollid;\r\n            $answer->save();\r\n\r\n            $answer2 = new PollAnswer();\r\n            $answer2->name = $request->answer2;\r\n            $answer2->poll_id = $pollid;\r\n            $answer2->save();\r\n\r\n\r\n            if ($request->answer3 === null){\r\n                $answer3 = new PollAnswer();\r\n                $answer3->name = '';\r\n                $answer3->poll_id = $pollid;\r\n                $answer3->save();\r\n            }  else{\r\n                $answer3 = new PollAnswer();\r\n                $answer3->name = $request->answer3;\r\n                $answer3->poll_id = $pollid;\r\n                $answer3->save();\r\n            }\r\n\r\n            if ($request->answer4 === null){\r\n                $answer4 = new PollAnswer();\r\n                $answer4->name = '';\r\n                $answer4->poll_id = $pollid;\r\n                $answer4->save();\r\n            } else{\r\n                $answer4 = new PollAnswer();\r\n                $answer4->name = $request->answer4;\r\n                $answer4->poll_id = $pollid;\r\n                $answer4->save();\r\n            }\r\n            event(new NewPollEvent());\r\n            return redirect()->route('polls.index')->with('success', 'New poll was created');\r\n    }\r\n\r\n    public function charRender()\r\n    {\r\n        $chart = New PollChart();\r\n\r\n        return view('layouts.app', compact('chart'));\r\n    }\r\n\r\n    // Export data\r\n    public function export(Request $request){\r\n\r\n        if ($request->input('exportexcel') !== null ){\r\n            return Excel::download(new PollExport, 'polls.xlsx');\r\n        }\r\n\r\n        if ($request->input('exportcsv') !== null ){\r\n            return Excel::download(new PollExport, 'polls.csv');\r\n        }\r\n\r\n        return redirect()->action('PollController@result');\r\n    }\r\n\r\n    public function downloadPDF() {\r\n        $polls = Poll::all();\r\n        // dd($posts);\r\n        $pdf = PDF::loadView('polls.pdf', compact('polls'));\r\n\r\n        return $pdf->download('polls.pdf');\r\n    }\r\n\r\n    public function storeComments(Request $request, PollCommentsStoreRequest $pollCommentsStoreRequest)\r\n    {\r\n        $pollComment = new PollComment();\r\n        $pollComment->username = auth()->user()->name;\r\n        $pollComment->poll_id = $request->pollid;\r\n        $pollComment->comments = $request->comments;\r\n\r\n        $pollComment->save();\r\n\r\n        return redirect()->route('polls.index')->with('success', 'Your comment was added');\r\n\r\n\r\n    }\r\n\r\n    public function allPolls($id)\r\n    {\r\n        //dd($id);\r\n        $poll = Poll::find($id);\r\n       //dd($poll);\r\n        $answers = PollAnswer::where('poll_id', $id)->get();\r\n        $pollComments = Poll::with('pollComments')->get()->sortByDesc('id')->first();\r\n        $allPolls = Poll::all();\r\n     //  dd($answers);\r\n        return view('polls.archive', compact('poll', 'answers', 'pollComments', 'allPolls'));\r\n\r\n    }\r\n\r\n    public function signup($id)\r\n    {\r\n        $signup = SignupTitle::where('id', $id)->first();\r\n        $signid = $signup->id;\r\n        $polls = Poll::where('signup_id', $signid)->get();\r\n        $archives = SignupTitle::all();\r\n        // dd($signid);\r\n        $results = Signup::where('signup_id', $signid)->get();\r\n\r\n        return view('polls.related', compact('signup', 'results', 'signid', 'polls', 'archives'));\r\n    }\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/Http/Controllers/PollController.php	(revision 96505ac51af98caee5316e62bb98006eac3ecdd0)
+++ app/Http/Controllers/PollController.php	(date 1587550809348)
@@ -40,6 +40,7 @@
         $polls = Poll::with('answer')->get()->sortByDesc('id')->first();
         $id = $polls->id;
         $answers = PollAnswer::where('poll_id', $id)->get();
+        //dd($answers);
         $authUserName = auth()->user()->name;
         $pollComments = Poll::with('pollComments')->get()->sortByDesc('id')->first();
         $chart = New PollChart();
@@ -48,6 +49,7 @@
 
         $allPolls = Poll::all();
         $signup = SignupTitle::where('id', $id)->first();
+        //dd($signup);
 
         return view('polls.index', compact(['polls', 'authUserName', 'answers', 'chart', 'pollComments', 'allPolls', 'signup']));
     }
@@ -75,6 +77,7 @@
 
     public function store(Request $request)
     {
+       // dd($request->all());
         $uname = $request->input('user');
         $p_id = $request->input('pollid');
         $userSign = PollResult::where('poll_id', $p_id)->where('username', $uname)->first();
